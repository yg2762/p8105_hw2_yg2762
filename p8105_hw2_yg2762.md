p8105\_hw2\_yg2762
================
Yang Gao
10/1/2021

``` r
library(tidyverse)
```

    ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──

    ## ✓ ggplot2 3.3.5     ✓ purrr   0.3.4
    ## ✓ tibble  3.1.4     ✓ dplyr   1.0.7
    ## ✓ tidyr   1.1.3     ✓ stringr 1.4.0
    ## ✓ readr   2.0.1     ✓ forcats 0.5.1

    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

``` r
library(readxl)
```

# Problem 1

Read and clean the Mr. Trash Wheel sheet

``` r
trash_wheel_df= read_excel("./data/trash-wheel.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N406") %>% 
  janitor :: clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate (sports_balls = round(sports_balls, digits= 0))

trash_wheel_df
```

    ## # A tibble: 344 × 14
    ##    dumpster month  year date                weight_tons volume_cubic_yards
    ##       <dbl> <chr> <dbl> <dttm>                    <dbl>              <dbl>
    ##  1        1 May    2014 2014-05-16 00:00:00        4.31                 18
    ##  2        2 May    2014 2014-05-16 00:00:00        2.74                 13
    ##  3        3 May    2014 2014-05-16 00:00:00        3.45                 15
    ##  4        4 May    2014 2014-05-17 00:00:00        3.1                  15
    ##  5        5 May    2014 2014-05-17 00:00:00        4.06                 18
    ##  6        6 May    2014 2014-05-20 00:00:00        2.71                 13
    ##  7        7 May    2014 2014-05-21 00:00:00        1.91                  8
    ##  8        8 May    2014 2014-05-28 00:00:00        3.7                  16
    ##  9        9 June   2014 2014-06-05 00:00:00        2.52                 14
    ## 10       10 June   2014 2014-06-11 00:00:00        3.76                 18
    ## # … with 334 more rows, and 8 more variables: plastic_bottles <dbl>,
    ## #   polystyrene <dbl>, cigarette_butts <dbl>, glass_bottles <dbl>,
    ## #   grocery_bags <dbl>, chip_bags <dbl>, sports_balls <dbl>,
    ## #   homes_powered <dbl>

Read and clean precipitation data for 2018 and 2019,omit rows without
precipitation data and add a variable for year.

``` r
precip2019_df = read_excel("./data/trash-wheel.xlsx", sheet="2019 Precipitation", range = "A2:B14") %>% 
  janitor :: clean_names() %>% 
  mutate (year = "2019") %>% 
  drop_na()
  
precip2019_df
```

    ## # A tibble: 6 × 3
    ##   month total year 
    ##   <dbl> <dbl> <chr>
    ## 1     1  3.1  2019 
    ## 2     2  3.64 2019 
    ## 3     3  4.47 2019 
    ## 4     4  1.46 2019 
    ## 5     5  3.58 2019 
    ## 6     6  0.42 2019

``` r
precip2018_df = read_excel ("./data/trash-wheel.xlsx", sheet="2018 Precipitation", range = "A2:B14") %>% 
  janitor :: clean_names() %>% 
  mutate (year = "2018") 
  
precip2018_df
```

    ## # A tibble: 12 × 3
    ##    month total year 
    ##    <dbl> <dbl> <chr>
    ##  1     1  0.94 2018 
    ##  2     2  4.8  2018 
    ##  3     3  2.69 2018 
    ##  4     4  4.69 2018 
    ##  5     5  9.27 2018 
    ##  6     6  4.77 2018 
    ##  7     7 10.2  2018 
    ##  8     8  6.45 2018 
    ##  9     9 10.5  2018 
    ## 10    10  2.12 2018 
    ## 11    11  7.82 2018 
    ## 12    12  6.11 2018

Combine precipitation datasets and convert month to a character variable

``` r
precip_df = 
  bind_rows (precip2018_df, precip2019_df) %>% 
  relocate (year) %>% 
  mutate(month = month.name[month])
precip_df
```

    ## # A tibble: 18 × 3
    ##    year  month     total
    ##    <chr> <chr>     <dbl>
    ##  1 2018  January    0.94
    ##  2 2018  February   4.8 
    ##  3 2018  March      2.69
    ##  4 2018  April      4.69
    ##  5 2018  May        9.27
    ##  6 2018  June       4.77
    ##  7 2018  July      10.2 
    ##  8 2018  August     6.45
    ##  9 2018  September 10.5 
    ## 10 2018  October    2.12
    ## 11 2018  November   7.82
    ## 12 2018  December   6.11
    ## 13 2019  January    3.1 
    ## 14 2019  February   3.64
    ## 15 2019  March      4.47
    ## 16 2019  April      1.46
    ## 17 2019  May        3.58
    ## 18 2019  June       0.42

Mr. Trash Wheel data `trash_wheel_df` contains 344 observations and 14
variables; the precipitation dataset`precip_df` contains 18 observations
and 3 variables. The total precipitation in 2018 is
`sum (precip2018_df$total)`, the median number of sports balls in a
dumpster in 2017 is
`trash_wheel_filter=filter(trash_wheel_df, year == 2017) median(trash_wheel_filter$sports_balls )`

``` r
trash_wheel_df
```

    ## # A tibble: 344 × 14
    ##    dumpster month  year date                weight_tons volume_cubic_yards
    ##       <dbl> <chr> <dbl> <dttm>                    <dbl>              <dbl>
    ##  1        1 May    2014 2014-05-16 00:00:00        4.31                 18
    ##  2        2 May    2014 2014-05-16 00:00:00        2.74                 13
    ##  3        3 May    2014 2014-05-16 00:00:00        3.45                 15
    ##  4        4 May    2014 2014-05-17 00:00:00        3.1                  15
    ##  5        5 May    2014 2014-05-17 00:00:00        4.06                 18
    ##  6        6 May    2014 2014-05-20 00:00:00        2.71                 13
    ##  7        7 May    2014 2014-05-21 00:00:00        1.91                  8
    ##  8        8 May    2014 2014-05-28 00:00:00        3.7                  16
    ##  9        9 June   2014 2014-06-05 00:00:00        2.52                 14
    ## 10       10 June   2014 2014-06-11 00:00:00        3.76                 18
    ## # … with 334 more rows, and 8 more variables: plastic_bottles <dbl>,
    ## #   polystyrene <dbl>, cigarette_butts <dbl>, glass_bottles <dbl>,
    ## #   grocery_bags <dbl>, chip_bags <dbl>, sports_balls <dbl>,
    ## #   homes_powered <dbl>

``` r
precip_df
```

    ## # A tibble: 18 × 3
    ##    year  month     total
    ##    <chr> <chr>     <dbl>
    ##  1 2018  January    0.94
    ##  2 2018  February   4.8 
    ##  3 2018  March      2.69
    ##  4 2018  April      4.69
    ##  5 2018  May        9.27
    ##  6 2018  June       4.77
    ##  7 2018  July      10.2 
    ##  8 2018  August     6.45
    ##  9 2018  September 10.5 
    ## 10 2018  October    2.12
    ## 11 2018  November   7.82
    ## 12 2018  December   6.11
    ## 13 2019  January    3.1 
    ## 14 2019  February   3.64
    ## 15 2019  March      4.47
    ## 16 2019  April      1.46
    ## 17 2019  May        3.58
    ## 18 2019  June       0.42

``` r
sum (precip2018_df$total)
```

    ## [1] 70.33

``` r
trash_wheel_filter=filter(trash_wheel_df, year == 2017)
median(trash_wheel_filter$sports_balls )
```

    ## [1] 8

# Problem 2

``` r
pols_month_df = read_csv("./data/pols-month.csv") %>% 
  janitor :: clean_names () %>% 
  separate(mon, into = c ("year", "month", "day"), sep ="-", convert = TRUE )%>% 
  mutate (month = month.name[month]) %>% 
  select (-prez_dem, -prez_gop) %>% 
  select (-day) %>% 
  pivot_longer(
    gov_gop:rep_dem,
    names_to = "president",
    values_to = "number"
  )
```

    ## Rows: 822 Columns: 9

    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon

    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
pols_month_df
```

    ## # A tibble: 4,932 × 4
    ##     year month    president number
    ##    <int> <chr>    <chr>      <dbl>
    ##  1  1947 January  gov_gop       23
    ##  2  1947 January  sen_gop       51
    ##  3  1947 January  rep_gop      253
    ##  4  1947 January  gov_dem       23
    ##  5  1947 January  sen_dem       45
    ##  6  1947 January  rep_dem      198
    ##  7  1947 February gov_gop       23
    ##  8  1947 February sen_gop       51
    ##  9  1947 February rep_gop      253
    ## 10  1947 February gov_dem       23
    ## # … with 4,922 more rows

``` r
snp_df = read_csv("./data/snp.csv") %>% 
  janitor :: clean_names() %>% 
  separate(date, into =c ("day", "month", "year"), sep = "/", convert =TRUE) %>% 
  mutate (month = month.name[month]) %>% 
  select (-day) %>% 
  mutate (year = if_else(year>15, year + 1900, year + 2000)) %>% 
  relocate (year, month)
```

    ## Rows: 787 Columns: 2

    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (1): date
    ## dbl (1): close

    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
snp_df
```

    ## # A tibble: 787 × 3
    ##     year month    close
    ##    <dbl> <chr>    <dbl>
    ##  1  2015 January  2080.
    ##  2  2015 January  2063.
    ##  3  2015 January  2107.
    ##  4  2015 January  2086.
    ##  5  2015 February 2068.
    ##  6  2015 February 2104.
    ##  7  2015 February 1995.
    ##  8  2014 January  2059.
    ##  9  2014 March    2068.
    ## 10  2014 January  2018.
    ## # … with 777 more rows

``` r
unemployment_df = read_csv( "./data/unemployment.csv",col_types = "ddd" ) %>% 
  janitor :: clean_names() %>% 
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "unemployment"
  ) %>% 
  mutate(month = factor(month)) %>% 
  mutate (month = month.name[month])
  

unemployment_df
```

    ## # A tibble: 816 × 3
    ##     year month     unemployment
    ##    <dbl> <chr>            <dbl>
    ##  1  1948 May                3.4
    ##  2  1948 April              3.8
    ##  3  1948 August             4  
    ##  4  1948 January            3.9
    ##  5  1948 September          3.5
    ##  6  1948 July               3.6
    ##  7  1948 June               3.6
    ##  8  1948 February           3.9
    ##  9  1948 December           3.8
    ## 10  1948 November           3.7
    ## # … with 806 more rows

``` r
snp_pol_df = 
  left_join (pols_month_df, snp_df, by =c("year", "month"))

snp_pol_df
```

    ## # A tibble: 8,346 × 5
    ##     year month    president number close
    ##    <dbl> <chr>    <chr>      <dbl> <dbl>
    ##  1  1947 January  gov_gop       23    NA
    ##  2  1947 January  sen_gop       51    NA
    ##  3  1947 January  rep_gop      253    NA
    ##  4  1947 January  gov_dem       23    NA
    ##  5  1947 January  sen_dem       45    NA
    ##  6  1947 January  rep_dem      198    NA
    ##  7  1947 February gov_gop       23    NA
    ##  8  1947 February sen_gop       51    NA
    ##  9  1947 February rep_gop      253    NA
    ## 10  1947 February gov_dem       23    NA
    ## # … with 8,336 more rows

``` r
final_df =
  left_join (snp_pol_df, unemployment_df, by= c("year", "month"))

final_df
```

    ## # A tibble: 8,346 × 6
    ##     year month    president number close unemployment
    ##    <dbl> <chr>    <chr>      <dbl> <dbl>        <dbl>
    ##  1  1947 January  gov_gop       23    NA           NA
    ##  2  1947 January  sen_gop       51    NA           NA
    ##  3  1947 January  rep_gop      253    NA           NA
    ##  4  1947 January  gov_dem       23    NA           NA
    ##  5  1947 January  sen_dem       45    NA           NA
    ##  6  1947 January  rep_dem      198    NA           NA
    ##  7  1947 February gov_gop       23    NA           NA
    ##  8  1947 February sen_gop       51    NA           NA
    ##  9  1947 February rep_gop      253    NA           NA
    ## 10  1947 February gov_dem       23    NA           NA
    ## # … with 8,336 more rows
