---
title: "p8105_hw2_yg2762"
author: "Yang Gao"
date: "10/1/2021"
output: github_document
---

```{r}
library(tidyverse)
library(readxl)
```

# Problem 1
Read and clean the Mr. Trash Wheel sheet

```{r}
trash_wheel_df= read_excel("./data/trash-wheel.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N406") %>% 
  janitor :: clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate (sports_balls = round(sports_balls, digits= 0))

trash_wheel_df
```


Read and clean precipitation data for 2018 and 2019,omit rows without precipitation data and add a variable for year.
```{r}
precip2019_df = read_excel("./data/trash-wheel.xlsx", sheet="2019 Precipitation", range = "A2:B14") %>% 
  janitor :: clean_names() %>% 
  mutate (year = "2019") %>% 
  drop_na()
  
precip2019_df


precip2018_df = read_excel ("./data/trash-wheel.xlsx", sheet="2018 Precipitation", range = "A2:B14") %>% 
  janitor :: clean_names() %>% 
  mutate (year = "2018") 
  
precip2018_df
```

Combine precipitation datasets and convert month to a character variable

```{r}
precip_df = 
  bind_rows (precip2018_df, precip2019_df) %>% 
  relocate (year) %>% 
  mutate(month = month.name[month])
precip_df
``` 
Mr. Trash Wheel data `trash_wheel_df` contains 344 observations and 14 variables; the precipitation dataset`precip_df` contains 18 observations and 3 variables. The total precipitation in 2018 is `sum (precip2018_df$total)`, the median number of sports balls in a dumpster in 2017 is `trash_wheel_filter=filter(trash_wheel_df, year == 2017)
median(trash_wheel_filter$sports_balls )`

```{r}
trash_wheel_df
precip_df

sum (precip2018_df$total)

trash_wheel_filter=filter(trash_wheel_df, year == 2017)
median(trash_wheel_filter$sports_balls )

```

# Problem 2

```{r}
pols_month_df = read_csv("./data/pols-month.csv") %>% 
  janitor :: clean_names () %>% 
  separate(mon, into = c ("year", "month", "day"), sep ="-", convert = TRUE )%>% 
  mutate (month = month.name[month]) %>% 
  select (-prez_dem, -prez_gop) %>% 
  select (-day) %>% 
  pivot_longer(
    gov_gop:rep_dem,
    names_to = "president",
    values_to = "number"
  )

pols_month_df
```

```{r}
snp_df = read_csv("./data/snp.csv") %>% 
  janitor :: clean_names() %>% 
  separate(date, into =c ("month", "day", "year"), sep = "/", convert =TRUE) %>% 
  mutate (month = month.name[month]) %>% 
  select (-day) %>% 
  mutate (year = if_else(year>15, year + 1900, year + 2000)) %>% 
  relocate (year, month)
 
 
snp_df
```

```{r}
unemployment_df = read_csv( "./data/unemployment.csv",col_types = "ddd" ) %>% 
  janitor :: clean_names() %>% 
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "unemployment"
  ) %>% 
  mutate(month = factor(month)) %>% 
  mutate (month = month.name[month])
  
unemployment_df
```

```{r}
snp_pol_df = 
  left_join (pols_month_df, snp_df, by =c("year", "month"))

snp_pol_df


final_df =
  left_join (snp_pol_df, unemployment_df, by= c("year", "month"))


final_df
```


# Problem 3
```{r}
baby_name_df =read_csv("./data/Popular_Baby_Names.csv") %>% 
  janitor:: clean_names() %>% 
  distinct() %>% 
  mutate(ethnicity =str_to_lower(ethnicity)) %>% 
  mutate(childs_first_name = str_to_lower (childs_first_name)) %>% 
  
  mutate(ethnicity = replace (
    ethnicity, ethnicity == "asian and paci", "asian and pacific islander")) %>% 
  mutate(ethnicity = replace (
    ethnicity, ethnicity == "black non hisp", "black non hispanic")) %>% 
  mutate(ethnicity = replace (
    ethnicity, ethnicity == "white non hisp", "white non hispanic"))
  

baby_name_df
```  
  
  
  
rank in popularity of the name “Olivia” as a female baby name over time;
```{r}
olivia_df = baby_name_df %>% 
  filter (childs_first_name == "olivia") %>% 
  select(-"gender", -"childs_first_name", -"count") %>% 
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "rank"
  )
  

knitr :: kable(olivia_df)
```

showing the most popular name among male children over time.
```{r}
male_name_df = baby_name_df %>% 
  filter (gender == "MALE" , rank == 1) %>% 
  select(-"rank", -"count", -"gender") %>% 
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "childs_first_name"
  )
  
knitr :: kable(male_name_df)
```



for male, white non-hispanic children born in 2016, produce a scatter plot showing the number of children with a name (y axis) against the rank in popularity of that name (x axis).

```{r}
plot_df = baby_name_df %>% 
  filter (gender == "MALE", year_of_birth == "2016", ethnicity == "white non hispanic") %>% 
  mutate(childs_first_name = factor(childs_first_name)) %>% 
  relocate(childs_first_name)
plot_df

```

```{r}
ggplot(plot_df, aes(x=rank, y=count)) + geom_point()

```


